bash -lc 'set -euo pipefail; CL=atlasnet-dev; HCFG=/home/danny/Desktop/AtlasNet/Dev/.kube/k3d-${CL}-host.yaml; TMP=$(mktemp); k3d kubeconfig get "$CL" > "$TMP"; CTX=$(kubectl --kubeconfig "$TMP" config current-context); C=$(kubectl --kubeconfig "$TMP" config view --minify -o jsonpath="{.contexts[0].context.cluster}"); U=$(kubectl --kubeconfig "$TMP" config view --minify -o jsonpath="{.contexts[0].context.user}"); P=$(kubectl --kubeconfig "$TMP" config view --minify -o jsonpath="{.clusters[0].cluster.server}" | sed -E "s#https://(0\\.0\\.0\\.0|127\\.0\\.0\\.1):##"); mkdir -p "$HOME/.kube" "$(dirname "$HCFG")"; touch "$HOME/.kube/config"; KUBECONFIG="$HOME/.kube/config" kubectl config delete-context "$CTX" >/dev/null 2>&1 || true; KUBECONFIG="$HOME/.kube/config" kubectl config delete-cluster "$C" >/dev/null 2>&1 || true; KUBECONFIG="$HOME/.kube/config" kubectl config unset "users.$U" >/dev/null 2>&1 || true; KUBECONFIG="$HOME/.kube/config" k3d kubeconfig merge "$CL" --kubeconfig-merge-default --kubeconfig-switch-context --update >/dev/null; KUBECONFIG="$HOME/.kube/config" kubectl config set-cluster "$C" --server "https://127.0.0.1:${P}" >/dev/null; cp "$TMP" "$HCFG"; kubectl --kubeconfig "$HCFG" config set-cluster "$C" --server "https://127.0.0.1:${P}" >/dev/null; pkill -f "/opt/Headlamp/resources/headlamp-server" >/dev/null 2>&1 || true; rm -f "$TMP"; kubectl get nodes'
